@page "/trustaccount"
@model TrustAccountModel
<style>
    .modal-dialog {
        overflow-y: initial !important
    }

    .modal-body {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
        background-color: #f4f3ef;
    }

    .modal-backdrop {
        background-color: gray;
    }

    .select2-results__option {
         padding: 2px; 
         font-size:12px;
       
    }
    .select2-container--default .select2-selection--multiple .select2-selection__choice__display {
        cursor: default;
        font-size: 11px !important;    
    }

/*    .full_modal-dialog {
        width: 1300px !important;
        height: 920 px !important;
        min-width: 1300px !important;
        min-height: 920 px !important;
        max-width: 1300px !important;
        max-height: 920 px !important;
        padding: 0 !important;
    }

    .full_modal-content {
        height: 99% !important;
        min-height: 99% !important;
    }*/

/*    .yadcf-filter
    {
        max-width:50px !important;
    }*/
    .btn.btn-icon {
        height: 1.3rem;
        min-width: 2.2rem;
        width: 2.2rem;
        padding: 0;
        font-size: 0.9375rem;
        overflow: hidden;
        position: relative;
        line-height: normal;
    }

   /* .select2-container--default .select2-selection--multiple {
        background-color: white;
        border: 1px solid #aaa;
        border-radius: 4px;
        cursor: text;
        padding-bottom: 0px;
        padding-right: 0px;
        position: relative;
    }
    .select2-container .select2-search--inline .select2-search__field {
        box-sizing: border-box;
        border: none;
        font-size: 100%;
        margin-top: 0px;
        margin-left: 0px;
        padding: 0;
        max-width: 100%;
        resize: none;
        height: 18px;
        vertical-align: bottom;
        font-family: sans-serif;
        overflow: hidden;
        word-break: keep-all;
    }
    .select2-container .select2-selection--multiple {
        box-sizing: border-box;
        cursor: pointer;
        display: block;
        min-height: 15px;
        user-select: none;
        -webkit-user-select: none;
    }*/

   .select2-selection--multiple{
      overflow: hidden !important;
      height: auto !important;
}
.select2-container {
  box-sizing: border-box;
  display: inline-block;
  margin: 0;
  position: relative;
  vertical-align: middle;
}
/* line 1, ../scss/_single.scss */
.select2-container .select2-selection--single {
  box-sizing: border-box;
  cursor: pointer;
  display: block;
  height: 38px;
  user-select: none;
  -webkit-user-select: none;
}
/* line 12, ../scss/_single.scss */
.select2-container .select2-selection--single .select2-selection__rendered {
  display: block;
  padding-left: 8px;
  padding-right: 20px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
/* line 25, ../scss/_single.scss */
.select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered {
  padding-right: 8px;
  padding-left: 20px;
}
/* line 1, ../scss/_multiple.scss */

.select2-container .select2-selection--multiple {
  box-sizing: border-box;
  cursor: pointer;
  display: block;
  user-select: none;
  -webkit-user-select: none;
}

.select2-container .select2-selection--multiple .select2-selection__rendered {
  display: inline-block;
  overflow: hidden;
  padding-left: 8px;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.select2-container .select2-search--inline {
  float:none;
}

.select2-container .select2-search--inline .select2-search__field {
  box-sizing: border-box;
  border: none;
  font-size: 100%;
  margin-top: 3px;
  margin-left: 3px;
}
 
.select2-container .select2-search--inline .select2-search__field::-webkit-search-cancel-button {
  -webkit-appearance: none;
}


.select2-dropdown {
  background-color: white;
  border: 1px solid #DDD;
  border-radius: 4px;
  box-sizing: border-box;
  display: block;
  position: absolute;
  left: -100000px;
  width: 100%;
  z-index: 1051;
}

















.select2-results {
  display: block;
}


.select2-results__options {
  list-style: none;
  list-style-type: none !important;
  margin: 0;
  padding: 0;
}

 
.select2-results__option {
  padding: 6px;
  user-select: none;
  -webkit-user-select: none;
}

.select2-results__option[aria-selected] {
  cursor: pointer;
}


.select2-container--open .select2-dropdown {
  left: 0;
}


.select2-container--open .select2-dropdown--above {
  border-bottom: none;
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}


.select2-container--open .select2-dropdown--below {
  border-top: none;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

.select2-search--dropdown {
  display: block;
  padding: 7px;
}

.select2-search--dropdown .select2-search__field {
  padding: 4px;
  width: 100%;
  box-sizing: border-box;
}

.select2-search--dropdown .select2-search__field::-webkit-search-cancel-button {
  -webkit-appearance: none;
}

.select2-search--dropdown.select2-search--hide {
  display: none;
}


.select2-close-mask {
  border: 0;
  margin: 0;
  padding: 0;
  display: block;
  position: fixed;
  left: 0;
  top: 0;
  min-height: 100%;
  min-width: 100%;
  height: auto;
  width: auto;
  opacity: 0;
  z-index: 99;
  background-color: #fff;
  filter: alpha(opacity=0);
}


.select2-container--default .select2-selection--single {
  background-color: #f0f0f0;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 2px;
}

.select2-container--default .select2-selection--single:focus {
  outline: 0;
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
  color: #444;
  line-height: 34px;
}

.select2-container--default .select2-selection--single .select2-selection__clear {
  cursor: pointer;
  float: right;
  font-weight: bold;
}

.select2-container--default .select2-selection--single .select2-selection__placeholder {
  color: #999;
}

.select2-container--default .select2-selection--single .select2-selection__arrow {
  height: 36px;
  position: absolute;
  top: 1px;
  right: 1px;
  width: 20px;
}

.select2-container--default .select2-selection--single .select2-selection__arrow b {
  border-color: #888 transparent transparent transparent;
  border-style: solid;
  border-width: 5px 4px 0 4px;
  height: 0;
  left: 50%;
  margin-left: -4px;
  margin-top: -2px;
  position: absolute;
  top: 50%;
  width: 0;
}
 
.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__clear {
  float: left;
}

.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__arrow {
  left: 1px;
  right: auto;
}

.select2-container--default.select2-container--disabled .select2-selection--single {
  background-color: #eee;
  cursor: default;
}

.select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear {
  display: none;
}

.select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b {
  border-color: transparent transparent #888 transparent;
  border-width: 0 4px 5px 4px;
}

.select2-container--default .select2-selection--multiple {
  background-color: #ffffff;
  border: 1px solid rgba(0, 0, 0, 0.1);
  -webkit-border-radius: 2px;
  border-radius: 2px;
  cursor: text;
  height: 22px;
}

.select2-container--default .select2-selection--multiple .select2-selection__rendered {
  box-sizing: border-box;
  list-style: none;
  list-style-type: none !important;
  padding: 0 0 0 4px !important;
  margin: 0;
  padding: 0 5px;
  width: 100%;
}

.select2-container--default .select2-selection--multiple .select2-selection__placeholder {
  color: #999;
  margin-top: 5px;
  float: left;
}

.select2-container--default .select2-selection--multiple .select2-selection__clear {
  cursor: pointer;
  float: right;
  font-weight: bold;
  margin-top: px;
  margin-right: 2px;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    color: #ffffff;
    background-color: #4a89dc;
 // border: 1px solid #ddd;
  border-radius: 2px;
  cursor: default;
  float: left;
  margin-right: 5px;
  margin-top: 1px;
  padding: 1px 2px 2px !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
  color: #fff;
  cursor: pointer;
  display: inline-block;
  font-weight: bold;
  margin-right: 2px;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
  color: #333;
}

.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice, .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__placeholder {
  float: right;
}
 
.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice {
  margin-left: 5px;
  margin-right: auto;
}

.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove {
  margin-left: 2px;
  margin-right: auto;
}

.select2-container--default.select2-container--focus .select2-selection--multiple {
  border: 1px solid #CCC;
  outline: 0;
}

.select2-container--default.select2-container--disabled .select2-selection--multiple {
  background-color: #eee;
  cursor: default;
}

.select2-container--default.select2-container--disabled .select2-selection__choice__remove {
  display: none;
}

.select2-container--default.select2-container--open.select2-container--above .select2-selection--single, .select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple {
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}
 
.select2-container--default.select2-container--open.select2-container--below .select2-selection--single, .select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

.select2-container--default .select2-search--dropdown .select2-search__field {
  border: 1px solid #DDD;
}

.select2-container--default .select2-search--dropdown .select2-search__field:focus {
  outline: 0;
}

.select2-container--default .select2-search--inline .select2-search__field {
  background: transparent;
  border: none;
  outline: 0;
}
 
.select2-container--default .select2-results > .select2-results__options {
  max-height: 200px;
  overflow-y: auto;
  padding: 2px !important;
}

.select2-container--default .select2-results__option[role=group] {
  padding: 0;
}

.select2-container--default .select2-results__option[aria-disabled=true] {
  color: #999;
}

.select2-container--default .select2-results__option[aria-selected=true] {
  background-color: #EEE;
}

.select2-container--default .select2-results__option .select2-results__option {
  padding-left: 1em;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__group {
  padding-left: 0;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__option {
  margin-left: -1em;
  padding-left: 2em;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
  margin-left: -2em;
  padding-left: 3em;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
  margin-left: -3em;
  padding-left: 4em;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
  margin-left: -4em;
  padding-left: 5em;
}

.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
  margin-left: -5em;
  padding-left: 6em;
}

.select2-container--default .select2-results__option--highlighted[aria-selected] {
  background-color: #4a89dc;
  color: white;
}

.select2-container--default .select2-results__group {
  cursor: default;
  display: block;
  padding: 6px;
}
    .yadcf-filter {
        padding-right: 2px !important;
        padding-left: 2px !important;
        padding-bottom: 5px !important;
        padding-top: 5px !important;
    }

</style>
<!-- #region CarousalModalRegion -->

<div class="modal fade" style="min-width:500px" id="CarousalModal" tabindex="-1" role="dialog" aria-labelledby="CarousalModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered  full_modal-dialog  modal-lg" role="document">
        <div class="modal-content full_modal-content">
            <div id="carouselExampleIndicator" class="carousel slide carousel-fade">
                <ol class="carousel-indicators">
                </ol>
                <div class="carousel-inner">
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicator" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicator" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>

        </div>
    </div>
</div>

<!-- #endregion CarousalModalRegion -->

<!-- #region UploadModalRegion -->

<div class="modal fade" style="min-width:500px" id="UploadModal" tabindex="-1" role="dialog" aria-labelledby="UploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered   modal-lg" role="document">
        <div class="modal-content">
            <form method="post" id="UploadForm" onsubmit='return Upload()' enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title" id="UploadModalLabel">Upload Files</h5>
                </div>


                <div class="modal-body">
                    <div class="reg-container row">

                        <div class="col-12">
                            <input type="hidden" id="idToUpload" />

                            <label id="NameofRecordToUpload"></label>
                            <table class="table table-sm mb-1 table-borderless table-condensed"
                                   id="documentsTable"
                                   data-sticky-header="true">
                                <tr>

                                    <td>
                                        <div class="custom-file form-group mt-md-1">

                                            <input type="file" class="custom-file-input form-control" multiple asp-for="RelatedFiles" />
                                            <label class="custom-file-label text-left" for="customFile">Click to Upload Invoices</label>
                                        </div>
                                        <div class="text-left">
                                            <span asp-validation-for="RelatedFiles" class="text-danger text-left"></span>
                                        </div>

                                    </td>
                                </tr>

                            </table>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <div class="row w-100">
                        <div class="col-6">
                            &nbsp;
                        </div>
                        <div class="col-3 text-right">
                            <input type="submit" value="Upload" id="UploadFile" class="btn btn-outline-success" />
                        </div>
                        <div class="col-2  text-right ">
                            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- #endregion UploadModalRegion -->

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title text-center">Trust Account</h6>
            </div>
            <div id="loadDiv" class="loading">Loading&#8230;</div>
            <div class="card-body">
                <table id="list" class="table w-100 dn table-bordered table-responsive compact stripe hover">
                    <thead>
                        @*<tr style="        background-color: #f8f9fa;
         color: black;">
            <th style="min-width:200px;">Month</th>
            <th style="min-width:200px;">Reference</th>
            <th style="min-width:200px;">DebtorCreditor</th>
            <th style="min-width: 200px;">Description</th>
            <th style="min-width:100px;">Amount</th>
            <th style="min-width:100px;">Bal</th>
            <th style="min-width:100px;">Invoice Added?</th>
            <th style="min-width:100px;">Invoice Required?</th>
            <th style="min-width:100px;">Group</th>
            <th style="min-width:100px;">Organization</th>
            <th style="min-width:100px;">Bills</th>
        </tr>*@
                        <tr style="background-color: #f8f9fa;
                         color: black;">
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                        <tr style="background-color: #f8f9fa;
                         color: black;">
                            <th id="id1"></th>
                            <th id="id2"></th>
                            <th id="id3"></th>
                            <th id="id4"></th>
                            <th id="id5"></th>
                            <th id="id6"></th>
                            <th id="id7"></th>
                            <th id="id8"></th>
                            <th id="id9"></th>
                            <th id="id10"></th>
                            <th id="id11"></th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="sum"></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </tfoot>

                </table>
            </div>
        </div>
    </div>

</div>

@section scripts {
    <script>

        $(document).ready(function () {
            var dataTable = $('#list').DataTable({
                ajax: { url: '?handler=List', dataSrc: '' },
                "orderCellsTop": true,
                responsive: true,
                "columns": [
                    {
                        title: "Month", data: "month",
                        render: function (data) {
                            if (data == null) return "";
                            var dt = new Date(data);
                            var month = dt.getMonth() + 1;
                            var monthvalue = "";
                            if (month < 10)
                                monthvalue = "0" + month;
                            else
                                monthvalue = "" + month;
                            return (dt.getFullYear() + "-" + monthvalue);
                        }
                    },
                    { title: "Ref", data: "reference" },
                    { title: "DrCr", data: "debtorcreditor" },
                    { title: "Desc", data: "description" },
                    { title: "Amt", data: "amount" },
                    {
                        title: "Bills",
                        data: "id",
                        "render": function (data, type, row, meta) {
                            var actions = '';
                            actions += '<a  class="btn btn-success btn-round btn-icon btn-icon-mini btn-neutral" href="#" data-toggle="modal"  data-target="#UploadModal" onClick="SetUpPopupToUploadRecord(' + '\'' + row.id + ';' + row.reference + '&nbsp;&nbsp;&nbsp;' + row.debtorcreditor + '&nbsp;&nbsp;&nbsp;' + row.description + ';' + '\'' + ')" ><i class="nc-icon nc-cloud-upload-94"></i></a>'

                            if (row.invoicesadded == "Yes") {
                                actions += '<a  class="btn btn-success btn-round btn-icon btn-icon-mini btn-neutral" href="#" data-toggle="modal"  data-target="#CarousalModal" onClick="SetUpCarousal(' + '\'' + row.id + ';' + row.reference + '&nbsp;&nbsp;&nbsp;' + row.debtorcreditor + '&nbsp;&nbsp;&nbsp;' + row.description + ';' + '\'' + ')" ><i class="nc-icon nc-image"></i></a>'
                            }

                            return actions;
                        },
                        orderable: false,
                        width: "50px"
                    },
                    { title: "group", data: "group" },
                    { title: "Org", data: "organization" },
                    { title: "Inv?", data: "invoicesadded" },
                    { title: "Inv needed?", data: "invoiceneeded" },
                    { title: "Bal", data: "runningtotal" }
                  
                    
                  
                ],

                drawCallback: function () {
                    var api = this.api();
                    $(api.table().column(4).footer()).html(
                        api.column(4, { page: 'current' }).data().sum().toFixed(2)
                    );
                }


            });
            yadcf.init(dataTable,
                [
                    { column_number: 0, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '150px' }, filter_container_id: "id1"  },
                    { column_number: 1, filter_type: 'text', filter_container_id: "id2",},
                    { column_number: 2, filter_type: 'text', filter_container_id: "id3", },
                    { column_number: 3, filter_type: 'text', filter_container_id: "id4", },
                    { column_number: 4, filter_type: 'text', filter_container_id: "id5", },
                    { column_number: 5, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '70px' }, filter_container_id: "id6"  },
                    { column_number: 6, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '70px' }, filter_container_id: "id7", },
                    { column_number: 7, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '70px' }, filter_container_id: "id8",  },
                    { column_number: 8, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '70px' }, filter_container_id: "id9", },
                    { column_number: 9, filter_type: 'multi_select', select_type: 'select2', select_type_options: { width: '70px' }, filter_container_id: "id10",  },
                ]);

            yadcf.exFilterColumn(dataTable, [[0, ['2020-11', '2020-12', '2021-01', '2021-02']]]);
         
            //title: "Month", data: "month",
            //    { title: "Ref", data: "reference" },
            //    { title: "DrCr", data: "debtorcreditor" },
            //    { title: "Desc", data: "description" },
            //    { title: "Amt", data: "amount" },
            //    title: "Bills",
            //        { title: "group", data: "group" },
            //        { title: "Org", data: "organization" }
            //{ title: "Inv?", data: "invoicesadded" },
            //{ title: "Inv needed?", data: "invoiceneeded" },
            //{ title: "Bal", data: "runningtotal" },
        });

        function SetUpPopupToUploadRecord(data) {
            var dataarray = data.split(";")
            $('#idToUpload').val(dataarray[0]);
            $('#NameofRecordToUpload').text(dataarray[1]);
        }

        function SetUpCarousal(data) {
            var dataarray = data.split(";")
            var fileData = new FormData();
            var item="";
            var indicators="";
            fileData.append("id", dataarray[0]);

            $.ajax({
                type: "Post",
                url: "?handler=GetImages",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (data) {
                    $("div.carousel-inner").empty();
                    $("ol.carousel-indicators").empty();
                    for (var i = 0; i < data.length; i++) {
                        indicators += "<li data-target='#carouselExampleIndicator' data-slide-to=" + i + "></li>";
                        item += "<div class='carousel-item'><img class='d-block w-100' src='/" + data[i] + "'></div>";
                      
                    }
                   
                    $("ol.carousel-indicators").append(indicators);
                    $("div.carousel-inner").append(item);
                    $("div.carousel-item").eq(0).addClass("active");
                    $("ol.carousel-indicators").eq(0).addClass("active");
                },
                error: function (err) {
                    alert(err);
                }

            })

            $('#NameofRecordToUpload').text(dataarray[1]);
        }

        $("#UploadFile").click(function (e) {

            e.preventDefault();

            var files = $("#RelatedFiles").get(0).files;
            var fileData = new FormData();
            fileData.append("id", $('#idToUpload').val());
            for (var i = 0; i < files.length; i++) {
                fileData.append("fileInput", files[i]);
            }
            $.ajax({
                type: "POST",
                beforeSend: function () { $('.ajax-loader').css("visibility", "visible"); },
                url: '?handler=UploadAllFiles',
                dataType: "json",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (data) {
                    $("#UploadModal").modal('hide');
                    if (data.success) {
                        MMNotify(data.message, "success");
                    }
                    else {
                        MMNotify(data.message, "danger");
                    }

                  
                },
                complete: function () { $('.ajax-loader').css("visibility", "hidden"); }
            });
        });

    </script>

}